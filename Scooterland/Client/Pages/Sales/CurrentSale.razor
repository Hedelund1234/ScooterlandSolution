@using Scooterland.Client.Modules.ProductModules;
@using Scooterland.Client.Modules.SaleModules;
@using Scooterland.Shared.Models;
@using Scooterland.Client.Services.CustomerServices;
@using Scooterland.Client.Services.SaleServices;
@page "/sales/current-sale"

<CurrentSaleOverview />

<div class="flex-box">
    <button class="btn btn-primary" @onclick="GoToInvoicePage">
        Gå til betaling
    </button>
</div>

@code {
    [Inject]
    public NavigationManager Navigation { get; set; }

    [Inject]
    public ISaleService SaleService { get; set; }

    [Parameter]
    [SupplyParameterFromQuery]
    public int SaleId { get; set; }

    private async Task GoToInvoicePage()
    {
        Sale currentSale = await SaleService.GetSale(SaleId);
        currentSale.EndDate = DateTime.Now;
		await SaleService.UpdateSale(currentSale);
		Navigation.NavigateTo($"/sales/invoice?SaleId={SaleId}");
	}


}
